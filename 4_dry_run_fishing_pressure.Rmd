---
title: "Prioritzr_dry_run_1"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(prioritizr)
library(here)

```

```{r}
# load raster planning unit data
pu <- here("rasters", "mz_id.tif")
pu_rast <-  raster(pu)

print(pu_rast)

plot(pu_rast)
```

```{r}
fishing_tif <- here("rasters", "fishing.tif")

fishing_raster <- raster(fishing_tif)

plot(fishing_raster)

fishing_df <- as.data.frame(fishing_raster)

# #scale all values 0-1 by dividing by max value using log-transformed +1 fishing values (+1 so that zero values are transformed to zero not NA)
fishing<- log(fishing_raster+1)/ cellStats(log(fishing_raster+1), max)

plot(fishing)

cost <- fishing
```

```{r}
# load feature data
features_stack = stack(here("rasters", "multilayer_feature.tif"))

con_features_df <- as.data.frame(features_stack)

plot(features_stack)

```

```{r}
# create problem
prob <- problem(cost, features = features_stack) %>%
  add_min_set_objective() %>%
  add_relative_targets(0.3)

print(problem)

#solve problem
sprob <- solve(prob)

plot(sprob,  main = c("30% Targets"))
```

```{r}
# lets load in existing MPA's to lockin to the design

mpa_tif <- (here("rasters", "mpa.tif")) 
mpa_raster <- raster(mpa_tif) 

plot(mpa_raster)

mpa_df <- as.data.frame(mpa_raster)
```

```{r}
# Create second conservation problem to protect 30% of each habitat while minimizing cost/overall with fishing effort proxy with areas selected as existing marine protected areas in the reserve design results

prob_with_lock_in <- prob %>% add_locked_in_constraints(mpa_raster)

sprob_lock_in <- solve(prob_with_lock_in)

plot(sprob_lock_in,  main ="30% with Existing MPAs locked in")
```

```{r}
# lets load in oil to lock out of design
oil_tif <- (here("rasters", "oil.tif")) 
oil_raster <- raster(oil_tif) 

plot(oil_raster)

oil_df <- as.data.frame(oil_raster)
```
```{r}
prob_with_pu <- prob %>% 
  add_locked_in_constraints(mpa_raster) %>%
  add_locked_out_constraints(oil_raster)

sprob_with_pu <- solve(prob_with_pu)

plot(sprob_with_pu,  main ="30% with Existing MPAs locked in and Oil locked out")
```

